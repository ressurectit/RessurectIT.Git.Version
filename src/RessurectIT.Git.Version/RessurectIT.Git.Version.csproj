<Project Sdk="Microsoft.NET.Sdk">
    <!-- BASIC INFO -->
    <PropertyGroup>
        <AssemblyName>RessurectIT.Git.Version</AssemblyName>
        <Description>RessurectIT helper tool for automatically generated version from git</Description>
    </PropertyGroup>

    <!-- BUILD OPTIONS -->
    <PropertyGroup>
        <OutputPath>bin\</OutputPath>
        <OutputType>Exe</OutputType>
    </PropertyGroup>

    <!-- FRAMEWORK -->
    <PropertyGroup>
        <TargetFrameworks>net462;net9.0</TargetFrameworks>
    </PropertyGroup>

    <!-- FILES -->
    <ItemGroup>
        <None Include="bin/net462/*.*" Pack="true" PackagePath="tools\win\" />
        <None Include="bin/net9.0/*.*" Pack="true" PackagePath="tools\dotnet\" />
        <None Include="Build/*.*" Pack="true" PackagePath="build\" />
        <None Include="Build/*.*" Pack="true" PackagePath="buildCrossTargeting\" />
        <None Include="node_modules/**/*.*" Pack="true" PackagePath="tools\node_modules" />
        <None Include="getVersion.js" Pack="true" PackagePath="tools\" />
        <None Include="$(ProjectDir)../../LICENSE" Pack="true" PackagePath="" />
    </ItemGroup>

    <!-- PACKAGING -->
    <PropertyGroup>
        <PackageTags>git;version;tool</PackageTags>
        <PackageLicenseFile>LICENSE</PackageLicenseFile>
        <IncludeBuildOutput>false</IncludeBuildOutput>

        <PackageReleaseNotes>
            - Features
                - now supports also unix build using dotnet 9
                - supports `ngv.config.json` with project dir as default
                - supports also environment variables from `npm-git-version`
                - supports `GitArgConfigPath` property for specifying `ngv.config.json` path
                - supports `GitArgNoIncrement` property for setting no increment flag
            - BREAKING CHANGES
                - minimal version of .net framework is 4.62
                - no default values for parameters
        </PackageReleaseNotes>
    </PropertyGroup>

    <!-- NUGET DEPENDENCIES -->
    <ItemGroup>
        <PackageReference Include="Jering.Javascript.NodeJS" />
        <PackageReference Include="Microsoft.Extensions.Configuration.Binder" />
        <PackageReference Include="Microsoft.Extensions.Configuration.CommandLine" />
        <PackageReference Include="Node.js.redist" />
        <PackageReference Include="RessurectIT.NuGet.Deployment" PrivateAssets="All" />
    </ItemGroup>

    <!-- NPM INSTALL -->
    <Target Name="NpmInstall" BeforeTargets="GenerateAdditionalSources" Condition="'$(TargetFramework)' == 'net462'">
        <!-- install all dependencies -->
        <Exec Command="npm install --loglevel error" WorkingDirectory="$(ProjectDir)" />
    </Target>
</Project>